# 実装計画

- [ ] 1. ワークフローテンプレート型定義の作成




  - WorkflowTemplate、WorkflowTemplateSaveRequest、WorkflowTemplateFilterインターフェースを定義
  - 既存のEditSessionとPatientWorkflowとの関連性を明確化
  - _要求事項: 1.2, 2.1, 5.2_

- [ ] 2. WorkflowTemplateServiceの実装
  - [ ] 2.1 基本的なCRUD操作の実装
    - createFromEditSession、getTemplates、updateTemplate、deleteTemplateメソッドを実装
    - Firestoreとの連携ロジックを作成
    - _要求事項: 1.2, 3.2_

  - [ ] 2.2 テンプレートフィルタリング機能の実装
    - カテゴリ、ソース、作成者によるフィルタリングロジックを実装
    - 検索機能とタグベースフィルタリングを追加
    - _要求事項: 2.1, 5.3_

  - [ ] 2.3 患者ワークフロー作成機能の実装
    - テンプレートから患者ワークフローを生成するメソッドを実装
    - 使用回数カウンターの更新ロジックを追加
    - _要求事項: 2.3_

- [ ] 3. カスタムフックの実装
  - [ ] 3.1 useWorkflowTemplatesフックの作成
    - テンプレート一覧取得、フィルタリング、キャッシュ機能を実装
    - React Queryを使用したデータ管理を追加
    - _要求事項: 2.1, 2.2_

  - [ ] 3.2 useEditSessionSaveフックの作成
    - 編集セッションからテンプレート保存の状態管理を実装
    - エラーハンドリングと成功通知機能を追加
    - _要求事項: 1.1, 1.3_

- [ ] 4. 編集セッション保存ダイアログコンポーネントの実装
  - [ ] 4.1 EditSessionSaveDialogの基本構造作成
    - ダイアログのレイアウトとフォーム要素を実装
    - 編集セッション内容のプレビュー表示機能を追加
    - _要求事項: 1.1_

  - [ ] 4.2 フォーム検証と保存処理の実装
    - テンプレート名、カテゴリ、説明の入力検証を実装
    - 保存ボタンクリック時の処理とエラーハンドリングを追加
    - _要求事項: 1.2, 1.3_

- [ ] 5. ワークフローテンプレート一覧コンポーネントの実装
  - [ ] 5.1 WorkflowTemplateListの基本表示機能
    - テンプレート一覧の表示とカード形式のレイアウトを実装
    - 編集セッション由来テンプレートの視覚的区別を追加
    - _要求事項: 2.1, 2.2_

  - [ ] 5.2 フィルタリングとソート機能の実装
    - カテゴリ、ソース、検索テキストによるフィルタリングUIを実装
    - 作成日時、使用回数によるソート機能を追加
    - _要求事項: 2.1, 5.3_

- [ ] 6. ワークフローテンプレートカードコンポーネントの実装
  - [ ] 6.1 WorkflowTemplateCardの表示機能
    - テンプレート情報の表示とアクションボタンを実装
    - ソース識別アイコンとメタデータ表示を追加
    - _要求事項: 2.2, 5.2_

  - [ ] 6.2 テンプレート操作機能の実装
    - 選択、編集、削除アクションの処理を実装
    - 確認ダイアログとエラーハンドリングを追加
    - _要求事項: 2.3, 3.1, 3.2_

- [ ] 7. 既存ページへの統合
  - [ ] 7.1 編集セッション画面への保存ボタン追加
    - 編集セッション画面に「ワークフローとして保存」ボタンを追加
    - ボタンクリック時のダイアログ表示処理を実装
    - _要求事項: 1.1_

  - [ ] 7.2 ワークフロー選択画面への統合
    - 既存のワークフロー選択画面にテンプレート一覧を統合
    - テンプレート選択時の患者ワークフロー作成処理を実装
    - _要求事項: 2.1, 2.3_

- [ ] 8. Firestoreセキュリティルールの実装
  - workflowTemplatesコレクションのセキュリティルールを作成
  - 読み取り、作成、更新、削除の権限制御を実装
  - _要求事項: 5.1, 5.2_

- [ ] 9. エラーハンドリングとバリデーションの実装
  - [ ] 9.1 フロントエンドバリデーション
    - テンプレート名の重複チェックとフォーム検証を実装
    - ユーザーフレンドリーなエラーメッセージ表示を追加
    - _要求事項: 1.2, 3.2_

  - [ ] 9.2 ネットワークエラーハンドリング
    - 保存失敗時のリトライ機能を実装
    - オフライン状態での適切なメッセージ表示を追加
    - _要求事項: 1.3_

- [ ] 10. 単体テストの実装
  - [ ] 10.1 サービス層のテスト
    - WorkflowTemplateServiceの各メソッドのテストを作成
    - モックFirestoreを使用したテストケースを実装
    - _要求事項: 1.2, 2.3, 3.2_

  - [ ] 10.2 コンポーネントのテスト
    - EditSessionSaveDialog、WorkflowTemplateList、WorkflowTemplateCardのテストを作成
    - ユーザーインタラクションのテストケースを実装
    - _要求事項: 1.1, 2.1, 3.1_

- [ ] 11. 統合テストの実装
  - 編集セッションからテンプレート保存までの完全なフローテストを作成
  - テンプレート選択から患者ワークフロー作成までのフローテストを実装
  - _要求事項: 1.1, 1.2, 1.3, 2.1, 2.3_

- [ ] 12. パフォーマンス最適化の実装
  - テンプレート一覧の仮想化とページネーション機能を実装
  - React Queryを使用したキャッシュ戦略を最適化
  - _要求事項: 2.1_